
<% layout('layouts/boilerplate.ejs') %>
<body>
    <script>
        const mapToken="<%=process.env.MAP_TOKEN%>";
        const coordinates= <%-JSON.stringify(listing.geometry.coordinates)%>;
    </script>

    <div class="row mt-3">
        <div class="col-md-8 offset-4">
    <h3><%=listing.title%></h3>
        </div>


    <div class="card col-10 offset-4 mt-3  listing-card" style="width: 25rem ;" >
    <img src="<%=listing.image.url%>"  
    class="img-fluid" style="max-height: 200px  ;" >
 
    <div class="card-body mt-2">
    <p class="card-text"><br>
        <p>owned by:<i><%=listing.owner.username%></i></p><br>
        <p><%= listing.description %><br></p><hr>
       <p> &#8377;<%=listing.price ? listing.price.toLocaleString("en-IN"):"N/A"%><br></p><hr>
        <p><%=listing.location%>,<br>
        <%=listing.country%><br><hr>
    </p>
  </div>

 
  <div class="btns col-1  show-btns mt-3 ">

     <a href="/listings/<%=listing._id%>/edit" class="btn btn-dark offset-3 edit-show-btn">Edit</a>
       <br>
       <hr>
       <a href="/listings" class="btn btn-dark offset-5 ok-btn">Ok</a>
       <hr>
       <br>


       <form method="POST" action="/listings/<%=listing._id%>?_method=DELETE">
        <button class="btn btn-dark offset-6">Delete</button>

       </form>
     


</div>
  
<div class="mb-3">
    <hr>
    <%if(currUser){%>

    <h4>Leave a Review</h4>
    <form action="/listings/<%=listing.id%>/reviews" 
         method="POST" 
         novalidate class="needs-validation">
        <div class="mb-3 mt-3">
            <label for="rating" 
            class="form-label">Rating</label>

            <fieldset class="starability-slot">
 <legend>Rating:</legend>
  <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked aria-label="No rating." />
  <input type="radio" id="first-rate1" name="review[rating]" value="1" />
  <label for="first-rate1" title="Terrible">1 star</label>
  <input type="radio" id="first-rate2" name="review[rating]" value="2" />
  <label for="first-rate2" title="Not good">2 stars</label>
  <input type="radio" id="first-rate3" name="review[rating]" value="3" />
  <label for="first-rate3" title="Average">3 stars</label>
  <input type="radio" id="first-rate4" name="review[rating]" value="4" />
  <label for="first-rate4" title="Very good">4 stars</label>
  <input type="radio" id="first-rate5" name="review[rating]" value="5" />
  <label for="first-rate5" title="Amazing">5 stars</label>
</fieldset>
            <!-- <input type="range"
             min="1"
              max="5"
               id="rating" 
               name="review[rating]" 
               class="form-range"> -->

        </div>

        


        <div class="mb-3 mt-3">
            <label for="comment" 
            class="form-label">Comments</label>
            <textarea name="review[comment]"
             id="comment" 
             cols="100" 
             rows="5" 
             class="form-control" required></textarea>
             <div class="invalid-feedback">
                Please add some comment for reviews
             </div>
        </div>
        <button class="btn btn-outline-dark">Submit</button>
    </form>

<%}%>

   


   
   

   
   <%if(listing.reviews.length>0){%> 
  <div class="reviews-grid ">
    <p><b>All Reviews</b></p> 

    <% for(review of listing.reviews){ %>
        <div class="row ">
        <div class="card  
        col-6
         ms-3
        mb-3
        review-card">
            

            
            <div class="card-body  ">
                <h5 class="card-title">@<%=review.author.username%></h5>
                
                <p class="starability-result  card-text" data-rating=<%=review.rating%>>
                  
                 </p>
                <p class="card-text"><%=review.comment%></p>
               
                
            </div>
            <%if(currUser && currUser._id.equals(review.author._id)){%>
            <form class="mb-3 mt-2  ml-2"  method="POST"  action="/listings/<%=listing._id%>/reviews/<%=review._id%>?_method=DELETE">
                <button class="btn  btn-sm btn-dark">Delete</button>
            </form>
            <%}%>

            </div>
           

        </div>

    <%}%>
    </div>
    <%}%>
   
    


    
</div>
 
   
      
</div>
<div class="col-8 offset-3 mb-3">
        <h3>Where you'll be</h3>
        <div id="map"></div>
    </div>
   


        
   
   
    </div>
     
   
 <script src="/js/map.js"></script>
   
</body>
